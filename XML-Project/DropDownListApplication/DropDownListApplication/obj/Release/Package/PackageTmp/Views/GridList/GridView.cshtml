
@{
    ViewBag.Title = "XML Extraction and Export";
}



<div class="tag-overalldiv" style=" margin-bottom: 30px">
    <div class="tag-header" style="margin-left: 83px; padding-top: 20px ">
        <h2>XML Extraction and Export</h2>
    </div>
    <hr style="margin-left: 83px;" />
    <div class="tag-uploader">
        <div>
            <input type="file" id="FileUpload1" onclick="fileChange()" value="null" required />
        </div>
        <div style="margin-left:63px">
            <input type="button" value="Upload" id="btnUpload" onclick="fileUpload()" class="btn tag-button " style="width: 100px;" />
        </div>
    </div>

    <div class="tag-overaldropdown " style=" margin-top: 10px">
        <div class="tag-flex tag-dropdownset1" flex; align-items: center">
            <div style="margin-left:15px;margin-right:15px;">
                <label for="cars">level 1</label>
                <select name="DropDownList2" class="dropdown-toggle-split dropdownlist  " id="FistDropDown">
                    <option>Select</option>
                </select>
            </div>

            <div style="margin-left:15px;margin-right:15px;">
                <label for="cars">level 2</label>
                <select name="DropDownList2" class="dropdown-toggle-split dropdownlist " id="SecondDropDown">
                    <option>Select</option>
                </select>
            </div>

            <div style="margin-left:15px;margin-right:15px;">
                <label for="cars">level 3</label>
                <select name="DropDownList2" class="dropdown-toggle-split dropdownlist " id="ThirdDropDown">
                    <option>Select</option>
                </select>
            </div>

            <div style="margin-left:15px;margin-right:15px;">
                <label for="cars">level 4</label>
                <select name="DropDownList2" class="dropdown-toggle-split dropdownlist " id="FourthDropDown">
                    <option>Select</option>
                </select>
            </div>
        </div>

        <div class="tag-flex tag-dropdownset1" align-items: center">
            <div style="margin-left:15px;margin-right:15px;">
                <label for="cars">level 5</label>
                <select name="DropDownList2" class="dropdown-toggle-split dropdownlist " id="FifthDropDown">
                    <option>Select</option>
                </select>
            </div>
            <div style="margin-left:15px;margin-right:15px;">
                <label for="cars">level 6</label>
                <select name="DropDownList3" class="dropdown-toggle-split dropdownlist" id="SixthDropDown">
                    <option>Select</option>
                </select>
            </div>
            <div style="margin-left:15px;margin-right:15px;">
                <label for="cars">level 7</label>
                <select name="DropDownList4" class="dropdown-toggle-split dropdownlist " id="SeventhDropDown">
                    <option>Select</option>
                </select>
            </div>
        </div>
    </div>

    <div class="tag-flex">
        <div style="text-align: center; margin-left: 428px; height: 60px;">
            <textarea rows="5" id="para" cols="60" name="description" style=" width: 519px; height: 66px" readonly>
         </textarea><br>

        </div>
        <div style=" margin-left: auto;">
            <input type="button" onclick="addHandler()" value="Add" class="btn  tag-button" style="width: 100px;" />
        </div>
    </div>
    <div style="text-align:center">
        <label style=" text-align: center; font-size: 30px; " size=" 50">List Of Items</label>
    </div>
    <div style="display: flex;">
        <div style="display: flex; max-height: 250px; overflow-y: scroll; width: 100%; " class="tablescroll">
            <table class="table " style=" width: 100%; border: 1px solid black; margin-bottom: 0px; margin-left: 25px">
                <thead>
                    <tr style=" background-color: #a59c9c; position: sticky; top: 0px;">
                        <th class="tabHead">
                            Level 1
                        </th>
                        <th class="tabHead">
                            Level 2
                        </th>
                        <th class="tabHead">
                            Level 3
                        </th>
                        <th class="tabHead">
                            Level 4
                        </th>
                        <th class="tabHead">
                            Level 5
                        </th>
                        <th class="tabHead">
                            Level 6
                        </th>
                        <th class="tabHead">
                            Level 7
                        </th>
                        <th class="tabHead">
                            Value
                        </th>
                    </tr>
                </thead>
                <tbody id="container">
                </tbody>
            </table>
        </div>
        <div style="margin-left: auto; margin-top: auto">
            <input type="button" value="Extract" onclick="extractHandler()" class="btn  tag-button" style="width: 100px;" />
        </div>
    </div>
    <br />
    <br />
    <div style="display:flex">
        <div id="Grid" style="display: flex; max-height: 250px; overflow-y: scroll; width: 100%; " class="tablescroll">
            <table class="table" id="mytable" style=" width: 100%; margin-bottom: 0px; margin-left: 25px; border: 1px solid black">
                <thead>
                    <tr style=" background-color: #a59c9c; position: sticky; top: 0px; width:100%">
                        <th class="tabHead">
                            Key
                        </th>
                        <th class="tabHead">
                            Value
                        </th>
                    </tr>
                </thead>
                <tbody id="secondTable">
                </tbody>
            </table>

        </div>
        <div style="margin-left: auto; margin-top: auto">
            <input type="submit" value="Export" class="btn tag-button" id="btnExport" name="button" onclick="importHTML()" style="width: 100px;" />
        </div>
    </div>

</div>
<style>
</style>


@section Scripts{
    <script type="text/javascript">

        var b = null;
        var valArr=[]
        function fileChange() {
            document.getElementById("FileUpload1").value = null;
            var select;
            select = document.getElementById("FistDropDown");
            clearOption(select);
            select = document.getElementById("SecondDropDown");
            clearOption(select);
            select = document.getElementById("ThirdDropDown");
            clearOption(select);
            select = document.getElementById("FourthDropDown");
            clearOption(select);
            select = document.getElementById("FifthDropDown");
            clearOption(select);
            select = document.getElementById("SixthDropDown");
            clearOption(select);
            select = document.getElementById("SeventhDropDown");
            clearOption(select);
            document.getElementById("para").innerHTML = "";
            b = null;
        }
        function clearOption(select) {
            var length = select.options.length;
            for (i = length - 1; i >= 1; i--) {
                select.options[i] = null;
            }
        }

        var levelarr = [];
        function add(k,v) {
            this.key = k;
            this.value = v;
        }

        //send the Second table grid to the csv file
        function importHTML() {
            var tblArr = [];
           let t = document.getElementById('secondTable');
            let l = t.childNodes.length;
            let j = 0;
            for (let i = 0; i < l; i++) {
                console.log(t.children[i])
                let key = t.children[i].children[j].innerHTML;
                j++;
                let value = t.children[i].children[j].innerHTML;
                j--;
                tblArr.push({ key: key, value: value })

            }

           

            //ajax call to send the second table grid to controller
            var filename = $('input[type=file]').val().replace(/C:\\fakepath\\/i, '');
            var objectArray = JSON.stringify({ 'exportExcel': tblArr,'fileName': filename });

            console.log(objectArray);
            console.log(filename);
            debugger
            $.ajax({
                url: "@Url.Action("Export")",
                contentType: 'application/json; charset=utf-8',
                dataType: 'json',
                type: 'POST',
                data: objectArray,
                @*data: { objectArray, fileName: filename},*@
                success: function (data) {
                    debugger
                }
            })
            var parent = document.getElementById("container");
            while (parent.firstChild) {
                parent.removeChild(parent.lastChild);
            }
            var myNode = document.getElementById("secondTable");
            while (myNode.firstChild) {
                myNode.removeChild(myNode.lastChild);
            }
            levelarr = [];
            flag = true;
        }

        //clear dropdown the after change the previews dropdown
        function clear(data) {
            switch (data) {
                case 1:
                    document.getElementById("SecondDropDown").options.length = 1;
                case 2:
                    document.getElementById("ThirdDropDown").options.length = 1;
                case 3:
                    document.getElementById("FourthDropDown").options.length =1;
                case 4:
                    document.getElementById("FifthDropDown").options.length = 1;
                case 5:
                    document.getElementById("SixthDropDown").options.length = 1;
                case 6:
                    document.getElementById("SeventhDropDown").options.length = 1;
                case 7:
                    document.getElementById("SeventhDropDown").options.length = 1;
            }
        }

        //First DropDownList Script
        let a;
        function fileUpload() {
            var files = $("#FileUpload1").get(0).files
                    var fileData = new FormData();
                    for (var i = 0; i < files.length; i++) {
                        fileData.append(files[i].name, files[i]);
                    }
            $.ajax({
                type: "POST",
                url: "@Url.Action("NodeObjects")",
                contentType: false,
                processData: false,
                data: fileData,
                success: function (data) {
                    console.log();
                    var code = []
                    var value = []
                    var drop1 = document.getElementById("FistDropDown");
                    for (var i = 0; i < data.length; i++) {
                        code.push(data[i].code)
                        var option = document.createElement("option")
                        option.text = data[i].code
                        option.id = String(i)+"FistDropDown"
                        drop1.add(option)

                        if (data[i].value === null)
                        {
                            value.push("NULL")
                            a = value;
                        } else
                        {
                            value.push(data[i].value)
                            console.log(data[i].value)
                            a = value;
                        }
                    }
                    drop1.addEventListener("change", () => {
                        if (value[code.indexOf(drop1.value)] == "NULL") {
                            document.getElementById("para").value= ""
                            secondDropDown();
                        } else {
                            clear(1)
                            b=value[code.indexOf(drop1.value)]
                            document.getElementById("para").value=""
                            document.getElementById("para").value=  value[code.indexOf(drop1.value)]
                        }
                    })
                }
            })
        }

        //second DropDownList Script
        function secondDropDown() {
            
            clear(1)
            var nodeName = "/"+ document.getElementById("FistDropDown").value
            var filename = $('input[type=file]').val().replace(/C:\\fakepath\\/i, '')
             let index = document.getElementById("FistDropDown").selectedIndex;
            $.ajax({
                type: "POST",
                url: "@Url.Action("GetFirstChileNodeByName")",
                data: { tagName: nodeName, uploadFileName: filename, nodeindex: index  },
                datatype: 'json',
                success: function (data) {
                    console.log(data);
                    var code = []
                    var value=[]
                    var drop1 = document.getElementById("SecondDropDown");
                    for (var i = 0; i < data.length; i++) {
                        code.push(data[i].code)
                        var option = document.createElement("option")
                        option.text = data[i].code
                        option.id = String(i) + " SecondDropDown";
                        console.log("option",option.id)
                        option.index = data[i].code
                        console.log(option.index = data[i].code)
                       
                        drop1.add(option)
                        if (data[i].value === null) {
                            value.push("NULL")
                            a = value;

                        } else {
                            value.push(data[i].value)
                            a = value;
                        }
                    }
                    drop1.addEventListener("change", () => {
                        console.log(value[code.indexOf(drop1.value)])
                        if (value[code.indexOf(drop1.value)] == "NULL") {
                            document.getElementById("para").value = ""
                            thirdDropDown();
                        } else {
                            clear(2)
                           b= value[code.indexOf(drop1.value)]
                            document.getElementById("para").value= ""
                            document.getElementById("para").value= value[code.indexOf(drop1.value)]
                        }
                    })
                }
            });

            //third DropDownList Script
        }
        function thirdDropDown() {
            clear(2)
            var nodeName2 = document.getElementById("FistDropDown").value
            var nodeName = document.getElementById("SecondDropDown").value
            var filename = $('input[type=file]').val().replace(/C:\\fakepath\\/i, '')
            var result = "//" + nodeName2 + "/" + nodeName;
            let index = document.getElementById("SecondDropDown").selectedIndex;
            $.ajax({
               type: "POST",
                url: "@Url.Action("GetFirstChileNodeByName")",
                data: { tagName: result, uploadFileName: filename, nodeindex: index},
                datatype: 'json',
                success: function (data) {
                    var code = []
                    var value = []
                    var drop1 = document.getElementById("ThirdDropDown");
                       for (var i = 0; i < data.length; i++) {
                           code.push(data[i].code)
                           var option = document.createElement("option")
                           option.text = data[i].code
                           option.id = String(i) + " ThirdDropDown";
                           drop1.add(option)
                           if (data[i].value === null) {
                               value.push("NULL")
                               a = value;

                        } else {
                               value.push(data[i].value)
                               a = value;

                        }
                       }
                       drop1.addEventListener("change", () => {
                           if (value[code.indexOf(drop1.value)] == "NULL") {
                               document.getElementById("para").value = ""
                               fourthDropDown();
                           } else {
                               clear(3)
                              b= value[code.indexOf(drop1.value)]
                               document.getElementById("para").value= ""
                               document.getElementById("para").value =  value[code.indexOf(drop1.value)]
                           }
                       })
                }
               });
        }

        //fourth DropDownList Script
        function fourthDropDown() {
            clear(3)
            var nodeName2 = document.getElementById("SecondDropDown").value
            var nodeName = document.getElementById("ThirdDropDown").value
            var filename = $('input[type=file]').val().replace(/C:\\fakepath\\/i, '')
            var result = "//" + nodeName2 + "/" + nodeName;
            let index=document.getElementById("ThirdDropDown").selectedIndex;
            $.ajax({
                type: "POST",
                url: "@Url.Action("GetFirstChileNodeByName")",
                data: { tagName: result, uploadFileName: filename, nodeindex: index },
                datatype: 'json',
                success: function (data) {
                    var code = []
                    var value = []
                    var drop1 = document.getElementById("FourthDropDown");
                    for (var i = 0; i < data.length; i++) {
                        code.push(data[i].code)
                        var option = document.createElement("option")
                        option.text = data[i].code
                        option.id = String(i) + " FourthDropDown";
                        drop1.add(option)
                        if (data[i].value === null) {
                            value.push("NULL")
                            a = value;

                        } else {
                            value.push(data[i].value)
                            a = value;

                        }
                    }
                    drop1.addEventListener("change", () => {
                        if (value[code.indexOf(drop1.value)] == "NULL") {
                            document.getElementById("para").value = ""
                            fifthDropDown();
                        } else {
                            clear(4)
                            b=value[code.indexOf(drop1.value)]
                            document.getElementById("para").value= ""
                            document.getElementById("para").value =  value[code.indexOf(drop1.value)]
                        }
                    })
                }
            });
        }

        //Fifth DropDownList Script
        function fifthDropDown() {
            clear(4)
            var nodeName2 = document.getElementById("ThirdDropDown").value
            var nodeName = document.getElementById("FourthDropDown").value
            var filename = $('input[type=file]').val().replace(/C:\\fakepath\\/i, '')
            var result = "//" + nodeName2 + "/" + nodeName;
            let index = document.getElementById("FourthDropDown").selectedIndex;
            $.ajax({
                type: "POST",
                url: "@Url.Action("GetFirstChileNodeByName")",
                data: { tagName: result, uploadFileName: filename, nodeindex: index},
                datatype: 'json',
                success: function (data) {
                    var code = []
                    var value = []
                    var drop1 = document.getElementById("FifthDropDown");
                    for (var i = 0; i < data.length; i++) {
                        code.push(data[i].code)
                        var option = document.createElement("option")
                        option.text = data[i].code
                        option.id = String(i) + " FifthDropDown";
                        drop1.add(option)
                        if (data[i].value === null) {
                            value.push("NULL")
                            a = value;

                        } else {
                            value.push(data[i].value)
                            a = value;

                        }
                    }
                    drop1.addEventListener("change", () => {
                        if (value[code.indexOf(drop1.value)] == "NULL") {
                            document.getElementById("para").value = ""
                            sixthDropDown();
                        } else {
                            clear(5)
                           b= value[code.indexOf(drop1.value)]
                            document.getElementById("para").value= ""
                            document.getElementById("para").value= value[code.indexOf(drop1.value)]
                        }
                    })                   
                }
            });
        }

        //sixth DropDownList Script
        function sixthDropDown() {
            clear(5)
            var nodeName2 = document.getElementById("FourthDropDown").value
            var nodeName = document.getElementById("FifthDropDown").value
            var result = "//" + nodeName2 + "/" + nodeName;
            var filename = $('input[type=file]').val().replace(/C:\\fakepath\\/i, '')
            let index = document.getElementById("FifthDropDown").selectedIndex;
            $.ajax({
                type: "POST",
                url: "@Url.Action("GetFirstChileNodeByName")",
                data: { tagName: result, uploadFileName: filename, nodeindex: index },
                datatype: 'json',
                success: function (data) {
                    var code = []
                    var value = []
                    var drop1 = document.getElementById("SixthDropDown");
                    for (var i = 0; i < data.length; i++) {
                        code.push(data[i].code)
                        var option = document.createElement("option")
                        option.text = data[i].code
                        option.id = String(i) + " SixthDropDown";
                        drop1.add(option)
                        if (data[i].value === null) {
                            value.push("NULL")
                            a = value;

                        } else {
                            value.push(data[i].value)
                            a = value;

                        }
                    }
                    drop1.addEventListener("change", () => {
                        if (value[code.indexOf(drop1.value)] == "NULL") {
                            document.getElementById("para").value = ""
                            seventhDropDown();
                        } else {
                            clear(6)
                            b = value[code.indexOf(drop1.value)];
                            document.getElementById("para").value = ""
                            document.getElementById("para").value =value[code.indexOf(drop1.value)]
                        }
                    })
                   
                }
            });
        }

        //seventhDropDown script
        function seventhDropDown() {
            clear(6)
            var nodeName2 = document.getElementById("FifthDropDown").value
            var nodeName = document.getElementById("SixthDropDown").value
            var result = "//" + nodeName2 + "/" + nodeName;
            var filename = $('input[type=file]').val().replace(/C:\\fakepath\\/i, '')
            let index = document.getElementById("SixthDropDown").selectedIndex;
            $.ajax({
                type: "POST",
                url: "@Url.Action("GetFirstChileNodeByName")",
                data: { tagName: result, uploadFileName: filename, nodeindex: index },
                datatype: 'json',
                success: function (data) {
                    var code = []
                    var value = []
                    var drop1 = document.getElementById("SeventhDropDown");
                    for (var i = 0; i < data.length; i++) {
                        code.push(data[i].code)
                        var option = document.createElement("option")
                        option.text = data[i].code
                        option.id = String(i) + " SeventhDropDown";
                        drop1.add(option)
                        if (data[i].value === null) {
                            value.push("NULL")
                            a = value;

                        } else {
                            value.push(data[i].value)
                            a = value;

                        }
                    }
                    drop1.addEventListener("change", () => {
                        if (value[code.indexOf(drop1.value)] == "NULL") {
                            document.getElementById("para").value = ""
                            seventhDropDown();
                        } else {
                            clear(7)
                            b = value[code.indexOf(drop1.value)];
                            document.getElementById("para").value = ""
                            document.getElementById("para").value =  value[code.indexOf(drop1.value)]
                        }
                    })
                    
                }
            });
        }



        //Add the dropdown value to the first table grid
        function addHandler() {
            if (b != null) {
                    var level = [
                        document.getElementById("FistDropDown").value,
                        document.getElementById("SecondDropDown").value,
                        document.getElementById("ThirdDropDown").value,
                        document.getElementById("FourthDropDown").value,
                        document.getElementById("FifthDropDown").value,
                        document.getElementById("SixthDropDown").value,
                        document.getElementById("SeventhDropDown").value
                    ];
                    var str = '';
                    for (var j = 0; j < level.length; j++) {
                        if (level[j] == 'Select') {
                            break;
                        }
                        str = str + level[j] + '/';
                    }
                    levelarr.push(str)
                    var parent = document.getElementById("container");
                    var tr = document.createElement("tr");
                tr.setAttribute("id", "row");

                    parent.appendChild(tr);


                    for (var i = 0; i < level.length; i++) {
                        var tag = document.createElement("td");
                        tag.setAttribute("class", "tabHead");
                        if (level[i] == "Select") {
                            tag.innerHTML = "N/A";
                        }
                        else
                            tag.innerHTML = level[i];
                        tr.appendChild(tag);
                    }
                var para = document.getElementById("para").value;
                valArr.push(para);
                    var tag = document.createElement("td");
                    tag.innerHTML = para;
                    tr.appendChild(tag);


                b = null;
            }

        }

        //clear the file and dropdown value after to change the new file
        function clearFile() {
            document.getElementById("FileUpload1").value = null;
        }

        //Exract the first table grid to the second table grid
        function extractHandler() {
            console.log("Extract Handler", levelarr);
            console.log("Value", valArr);
            var myNode = document.getElementById("secondTable");
            while (myNode.firstChild) {
                myNode.removeChild(myNode.lastChild);
            }
            var p = document.getElementById("secondTable");
            for (var i = 0; i < levelarr.length; i++) {
                var tableRow = document.createElement("tr");
                    p.appendChild(tableRow)
                    var tag = document.createElement("td");
                var tag1 = document.createElement("td");
                tag.setAttribute("class", "tabHead");
                    tag.innerHTML = levelarr[i];
                    tableRow.appendChild(tag);
                tag1.innerHTML = valArr[i];
                tableRow.appendChild(tag1);
                debugger
            }
        }
    </script>
}
